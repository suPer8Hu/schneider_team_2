<!-- templates/index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freight Load Search</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f7f8fa;
            font-family: Arial, sans-serif;
        }
        .container {
            margin-top: 30px;
        }
        .header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .header img {
            height: 50px;
        }
        .header h1 {
            color: #ff6600;
            font-size: 1.8rem;
        }
        .filter-panel, .load-entry {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .results-heading {
            color: #ff6600;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .range-display {
            font-weight: bold;
            color: #333;
            text-align: center;
        }
        .btn-search, .btn-book {
            background-color: #ff6600;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        .btn-watch {
            background-color: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        .btn-book:hover, .btn-search:hover {
            background-color: #e65c00;
        }
        .btn-watch:hover {
            background-color: #d4d4d4;
        }
        /* Ensure the map image scales properly */
        .map-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'warning' if category == 'warning' else 'info' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Header with Logo -->
    <div class="header">
        <img src="{{ url_for('static', filename='schneider_logo.png') }}" alt="Schneider Logo">
        <h1>Freight Load Search</h1>
    </div>

    <div class="row">
        <!-- Left: Search Filters -->
        <div class="col-md-4">
            <div class="filter-panel">
                <h4 class="text-orange">Search Filters</h4>
                <form method="POST">
                    <!-- Capacity Type -->
                    <label for="type_truck">Capacity Type</label>
                    <select id="type_truck" name="type_truck" class="form-select mb-3" required>
                        <option value="Dry Van" {% if type_truck == 'Dry Van' %}selected{% endif %}>Dry Van</option>
                        <option value="Reefer" {% if type_truck == 'Reefer' %}selected{% endif %}>Reefer</option>
                        <option value="Flatbed" {% if type_truck == 'Flatbed' %}selected{% endif %}>Flatbed</option>
                        <option value="Power Only" {% if type_truck == 'Power Only' %}selected{% endif %}>Power Only</option>
                    </select>

                    <!-- Origin City -->
                    <label for="origin_city">Origin City</label>
                    <select id="origin_city" name="origin_city" class="form-select mb-3" required>
                        {% if unique_origin_cities %}
                            {% for city in unique_origin_cities %}
                                <option value="{{ city }}" {% if origin_city == city %}selected{% endif %}>{{ city }}</option>
                            {% endfor %}
                        {% else %}
                            <option value="" disabled>No Origin Cities Available</option>
                        {% endif %}
                    </select>

                    <!-- Origin State -->
                    <label for="origin_state">Origin State</label>
                    <select id="origin_state" name="origin_state" class="form-select mb-3" required>
                        {% if unique_origin_states %}
                            {% for state in unique_origin_states %}
                                <option value="{{ state }}" {% if origin_state == state %}selected{% endif %}>{{ state }}</option>
                            {% endfor %}
                        {% else %}
                            <option value="" disabled>No Origin States Available</option>
                        {% endif %}
                    </select>

                    <!-- Search Radius -->
                    <label for="radius" class="range-label">Search Radius (miles)</label>
                    <input type="range" class="form-range mb-3" min="25" max="400" step="25" id="radius" name="radius" value="{{ radius }}" oninput="document.getElementById('radiusValue').innerText = this.value + ' miles';">
                    <div id="radiusValue" class="range-display">{{ radius }} miles</div>

                    <!-- Destination City -->
                    <label for="dest_city">Destination City</label>
                    <select id="dest_city" name="dest_city" class="form-select mb-3" required>
                        {% if unique_dest_cities %}
                            {% for city in unique_dest_cities %}
                                <option value="{{ city }}" {% if dest_city == city %}selected{% endif %}>{{ city }}</option>
                            {% endfor %}
                        {% else %}
                            <option value="" disabled>No Destination Cities Available</option>
                        {% endif %}
                    </select>

                    <!-- Destination State -->
                    <label for="dest_state">Destination State</label>
                    <select id="dest_state" name="dest_state" class="form-select mb-3" required>
                        {% if unique_dest_states %}
                            {% for state in unique_dest_states %}
                                <option value="{{ state }}" {% if dest_state == state %}selected{% endif %}>{{ state }}</option>
                            {% endfor %}
                        {% else %}
                            <option value="" disabled>No Destination States Available</option>
                        {% endif %}
                    </select>

                    <button type="submit" class="btn-search w-100 mt-3">Search</button>
                </form>
            </div>
        </div>

        <!-- Right: Load Listings -->
        <div class="col-md-8">
            <div class="results-heading">Load Search Results</div>

            {% if results %}
                {% for result in results %}
                    <div class="load-entry mt-3">
                        <div class="load-header">{{ result['LOAD_ID'] }} - {{ result['distance'] | round(2) }} miles</div>
                        <div class="load-details d-flex justify-content-between">
                            <div>
                                <p><strong>Origin:</strong> {{ result['Pickup_City'] }}, {{ result['Pickup_State'] }}</p>
                                <p><strong>Destination:</strong> {{ result['Destination_City'] }}, {{ result['Destination_State'] }}</p>
                                <p><strong>Weight:</strong> {{ result['TOTAL_WEIGHT'] }} {{ result['WEIGHT_UOM'] }}</p>
                                <p><strong>Transport Mode:</strong> {{ result['TRANSPORT_MODE'] }}</p>
                            </div>
                            <div class="text-end">
                                <p><strong>Load Time:</strong> {{ result['APPOINTMENT_FROM'] }}</p>
                                <p><strong>Status:</strong> {{ result['POSTING_STATUS'] }}</p>
                                <div class="mt-2">
                                    <button class="btn-watch">Watch</button>
                                    <button class="btn-book">Contact to Book</button>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>No loads available. Please refine your search.</p>
            {% endif %}

            <!-- Map Display Section -->
            {% if map_image %}
                <div class="mt-4 map-container">
                    <h5 class="text-center">Route Map</h5>
                    <div class="text-center">
                        <img src="data:image/png;base64,{{ map_image }}" alt="Route Map" class="img-fluid rounded">
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Bootstrap JS (optional, for interactive components like flash message dismiss) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
